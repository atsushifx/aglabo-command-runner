---
title: WORKFLOW - 内部フロー詳細
---

<!-- textlint-disable ja-technical-writing/max-comma -->

## WORKFLOW - 内部フロー詳細

## 概要: 開発環境・コーディング状態の管理レイヤー

このワークフローは、コーディングセッション全体における開発環境と実装状態を管理するメタレイヤーです。
以下の責務を持ちます。

- 開発言語・開発環境の把握と管理 (build, run, lint などの開発ツール設定)
- セッション・タスク情報の動的取得
- プロジェクト規約・コード様式の参照
- 実装状態の追跡と記録
- 品質ゲートの実行と検証

---

## ワークフロー全体マップ

コーディングセッション全体は以下の 0-6 のフェーズで構成されます。

```bash
Phase 0: 開発環境の取得、設定
    ↓
Phase 1: deckrd の active タスクからタスクリストを取得
    ↓
Phase 2: 呼び出し時のパラメータ、タスクリストから実装タスクリストを取得
    ↓
Phase 3: 実装タスクリストに従って、コーディング (= Red-Green-Refactor 実装)
    ↓
Phase 4: 品質ゲート実行 (Lint, 型チェック, テスト)
    ↓
Phase 5: コーディング終了確認
    ↓
Phase 6: ワークフロー終了
```

| Phase   | 目的                   | 出力                         |
| ------- | ---------------------- | ---------------------------- |
| Phase 0 | 開発言語・環境を把握   | 開発ツール設定、実行コマンド |
| Phase 1 | アクティブタスクを特定 | タスクID、テストケース一覧   |
| Phase 2 | 実装対象を細分化       | 実装タスクリスト             |
| Phase 3 | コーディング実行       | テスト合格、実装コード       |
| Phase 4 | 品質を検証             | 品質ゲート合格確認           |
| Phase 5 | 完了状態を確認         | セッション終了前の最終確認   |
| Phase 6 | セッション終了         | 開発ツール・状態をリセット   |

---

## Phase 0: 初期化フェーズ (開発環境把握)

コーディングセッション開始時に、リポジトリルート (モノレポの場合はサブパッケージのルート) で開発環境を把握・確認します。

実行内容:

- リポジトリルート / サブパッケージルートを特定
- 開発言語を確認 (`package.json`, `Cargo.toml`, `setup.py` など)
- 開発ツール設定を取得 (Build, Run, Lint, 型チェック, テスト, フォーマッター)
- 実行コマンドを記録・整理

出力:

- 開発言語、利用ツール一覧、実行コマンド

---

## Phase 1: deckrd の active タスクからタスクリストを取得

アクティブなセッション情報から、コーディング対象のタスク定義を取得します。

実行内容:

- `docs/.deckrd/coder.session` の `DECKRD_ACTIVE_SESSION` から現在セッションを取得
- `DECKRD_TASK_FILE` で指定されたタスク MD ファイルを読み込む
- 指定されたタスク ID のセクションを抽出
- テストケース一覧、Given-When-Then 詳細を確認

出力:

- タスク ID、テストケース一覧、テスト仕様

---

## Phase 2: 呼び出し時のパラメータ、タスクリストから実装タスクリストを取得

ユーザーから受け取ったパラメータと Phase 1 で取得したタスク仕様から、実装対象を細分化します。

実行内容:

- ユーザーの要件 (呼び出しパラメータ) を分析
- タスクを単一テストケース単位に分割
- 実装タスクリストを作成・記録

出力: 実装タスクリスト (テストケースごとのタスク)

---

## Phase 3: 実装タスクリストに従って、コーディング

Red-Green-Refactor サイクルで実装タスクを完了します。

実行内容:

- **ステップ 1～8** に従い、厳密な BDD プロセスで実装
- 各ステップで品質ゲート実行
- タスク完了ごとに進捗を記録

詳細:

- [implementation.md](./implementation.md) を参照

出力:

- テスト合格、実装コード完成

---

## Phase 4: 品質ゲート実行

全体的なコード品質を検証します。

実行内容:

- Lint チェック実行
- 型チェック実行
- テスト実行
- すべてのチェックが合格することを確認

出力:

- 品質ゲート合格

---

## Phase 5: コーディング終了確認

セッション終了前に、実装が完了したことを確認します。

実行内容:

- 全テスト PASS 確認
- 型エラーなし確認
- 実装タスクリストがすべてチェック済み確認
- Refactor が完了したか確認

出力:

- コーディング完了状態

---

## Phase 6: ワークフロー終了

セッションを終了し、開発環境をリセットします。

実行内容:

- 開発ツール・状態をリセット
- セッション情報をクリア
- コミットはユーザーが手動実施

出力:

- セッション終了
