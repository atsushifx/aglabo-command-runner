# BDD Coder Prompt Template

このテンプレートを使用して、bdd-coder エージェントに正確な指示を与えます。

## テンプレート

```markdown
# BDD Implementation Task

## Task Summary

[実装する機能の簡潔な説明]

## Requirements

- [要件1]
- [要件2]
- [要件3]

## Important Constraints

### Single Expect Rule

- **1つのテスト = 1つの振る舞い**: 各テストは1つの結果のみを検証する
- **expect は1度に1つ**: 複数の検証が必要な場合は、テストを分割する
- **1メッセージ = 1expect追加**: 進捗報告ごとに expect を1つだけ追加する

### BDD Structure

- **Given**: テストの前提条件（describe直下のコメント）
- **When**: 実行するアクション（テストの本体）
- **Then**: 期待される結果（単一のexpect）

### Example Format (Language-Agnostic)
```

Test Suite: funcName

Test Case: should <behavior> when <condition>
Given: <precondition>
When: <action>
Then: <single assertion>

```
## Test Implementation Workflow

For each behavior being tested:
1. Write ONE test with ONE expect statement
2. Run test to ensure it fails (Red phase)
3. Implement minimal code to pass test (Green phase)
4. Refactor if needed while keeping test passing (Refactor phase)
5. Move to next behavior and repeat

## Coverage to Implement

- [ ] Normal case: Happy path with valid inputs
- [ ] Invalid input: Type mismatches, null/undefined, wrong formats
- [ ] Edge cases: Boundary values, empty collections, special characters

Do NOT combine these into one test. Create separate tests for each.

## Output Format

When reporting progress:
1. Show the new test added
2. Show implementation changes
3. Show test run result
4. Confirm before adding next expect

## Key Points to Remember

- ❌ NEVER add 8 expects in one test
- ❌ NEVER add multiple expects in one it() block
- ✅ DO create multiple it() blocks with one expect each
- ✅ DO focus each test on a single behavior
- ✅ DO report progress for each expect added
```

## 使用方法

### 基本的な使い方

```bash
# bdd-coder を実行する際、以下の形式でプロンプトを作成：

bdd-coder エージェントに以下を伝える：
1. 実装する機能の説明
2. "Important Constraints" セクションの内容を強調
3. "Coverage to Implement" でテスト項目を明記
```

### プロンプト例（汎用版）

```markdown
## 実装タスク: [機能名] のテスト実装

このテンプレートに従ってください（**重要**）:

### Important Constraints

- **1つのテスト = 1つの振る舞い**
- **1つのアサーション = 1つのテスト**
- 複数の検証が必要な場合は、複数のテストに分割する

### Test Implementation Workflow

1. **First test**: Normal case (Happy path)
   - テスト名で振る舞いを明記: 「should [期待される動作] when [条件]」
   - 1つのアサーションのみ実装

2. **Red Phase**: テストを実行して失敗を確認
3. **Green Phase**: 最小限のコードを実装してテストを合格させる
4. **Refactor**: 必要に応じてコードをリファクタリング（テスト継続合格）
5. **次のテスト**: Invalid input, Edge cases を同じプロセスで実装

### Coverage Required

- [ ] Normal: Happy path with valid input
- [ ] Invalid: Type mismatches, null/undefined, invalid values
- [ ] Edge case: Boundary conditions, empty/special values

---

**Remember**: Each test = One assertion only!
```

### TypeScript/Vitest Implementation Reference

実際のTypeScript実装では、以下の形式を使用してください：

```typescript
describe('funcName', () => {
  // Given: <precondition>
  it('should <behavior> when <condition>', () => {
    // When: <action>
    // Then: <single assertion>
    expect(result).toBe(expected);
  });
});
```

## テンプレート参照時のチェックリスト

実装前に確認：

- [ ] このテンプレートを読んだ
- [ ] 「Single Expect Rule」を理解した
- [ ] 1メッセージ = 1expect の原則を確認した
- [ ] テスト分割方法を理解した
- [ ] BDD 構造（Given-When-Then）を確認した

実装中に確認：

- [ ] 各 it() ブロックに expect は1つだけか？
- [ ] テストの名前が振る舞い（behavior）を表しているか？
- [ ] Red → Green → Refactor サイクルを回しているか？
- [ ] 進捗報告時に新しい expect を説明しているか？

## 参考資料

- 詳細な BDD ガイドライン: `code_style_conventions` メモリ参照
- テスト ファイル構成: `docs/dev-standards/05-coding-conventions.md`
- プロジェクト タスク: `docs/.deckrd/command-runner/os2shell/tasks/tasks.md`
